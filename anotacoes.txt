SERVIDOR TINHA 1409 LINHAS DE CÓDIGO NO INDEX.JS ANTES DA REESTRUTURAÇÃO NO SERVIDOR.
ÁREA PARA INFORMACOES SOBRE 

ESTRUTURA DAS DATABASES:

-lojas-
    ->produtos
    ->vendas
    ->vendas_itens(Os itens vendidos em vendas.)
    ->vendas_pagamentos
    ->pixgerados(futuramente para quando o cliente puder gerar o pix diretamente na tela de vendas.)


-usuarios-
    ->contas_usuarios
    ->status_planos
    ->pixgerados(para pix que os usuarios do sistema geraram para pagar algo do sistema.)


DATABASE LOJAS:
-> CREATE DATABASE lojas;

-TABELA PRODUTOS: (vou reestruturar as vendas primeiro.)

DENTRO DA DATABASE LOJAS:
-TABELA PRODUTOS:
    CREATE TABLE produtos (
        id BIGINT AUTO_INCREMENT PRIMARY KEY,

        loja_id INT NOT NULL,

        codigo_produto VARCHAR(50) NOT NULL, -- código de barras ou código manual

        nome VARCHAR(150) NOT NULL,
        tamanho VARCHAR(20),

        estoque INT NOT NULL DEFAULT 0,

        preco_compra DECIMAL(10,2) NOT NULL,
        preco_venda DECIMAL(10,2) NOT NULL,

        local_armazenamento VARCHAR(50),

        ativo BOOLEAN DEFAULT TRUE,

        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

        UNIQUE KEY uk_loja_codigo (loja_id, codigo_produto),
        INDEX idx_loja (loja_id),
        INDEX idx_loja_nome (loja_id, nome)
    );



-TABELA VENDAS & VENDA_ITENS:
---VENDAS---
    CREATE TABLE vendas(
        id BIGINT AUTO_INCREMENT PRIMARY KEY,
        loja_id INT NOT NULL,
        data_venda DATE NOT NULL,
        hora_venda TIME NOT NULL,
        total DECIMAL(10,2) NOT NULL,
        custo_total decimal(10,2) NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

        INDEX idx_loja_data (loja_id, data_venda)
    );

    ---ADAPTANDO A TABELA VENDAS---
        *Adicionar status da venda*
        *Preciso para usar a tela de vendas por mesa*
        ALTER TABLE vendas 
        ADD status ENUM('aberta', 'fechada', 'cancelada') 
        NOT NULL DEFAULT 'aberta';

        *Permitir NULL enquanto a venda está aberta.
        ALTER TABLE vendas
        MODIFY data_venda DATE NULL,
        MODIFY hora_venda TIME NULL,
        MODIFY total DECIMAL(10,2) NULL,
        MODIFY custo_total DECIMAL(10,2) NULL;

        *Adiciono indice da mesa para busca rápida:
        CREATE INDEX idx_vendas_loja_status 
        ON vendas(loja_id, status);

---FIM VENDAS---

---MESAS---
CREATE TABLE mesas (
    id BIGINT(20) NOT NULL AUTO_INCREMENT PRIMARY KEY,

    loja_id INT(11) NOT NULL,

    identificador VARCHAR(100) NOT NULL, 

    venda_id BIGINT(20) NOT NULL,

    criada_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_loja (loja_id),
    INDEX idx_venda (venda_id),

    CONSTRAINT fk_mesa_venda 
        FOREIGN KEY (venda_id) REFERENCES vendas(id)
) ENGINE=InnoDB;

    --ADAPTANDO TABLE MESAS---
    *Para garantir que uma mesma loja não possa criar duas mesas 2 por exemplo
    ALTER TABLE mesas
    ADD UNIQUE KEY uk_loja_identificador (loja_id, identificador);


---FIM MESAS

---VENDAS ITENS---
    CREATE TABLE vendas_itens (
        id BIGINT AUTO_INCREMENT PRIMARY KEY,
        venda_id BIGINT NOT NULL,
        produto_id INT NOT NULL,

        produto_nome VARCHAR(100) NOT NULL, -- snapshot
        quantidade INT NOT NULL,
        preco_venda DECIMAL(10,2) NOT NULL,
        preco_compra DECIMAL(10,2) NOT NULL,
        subtotal DECIMAL(10,2) NOT NULL,

        FOREIGN KEY (venda_id) REFERENCES vendas(id),
        INDEX idx_venda (venda_id),
        INDEX idx_produto (produto_id)
    );

    --ADAPTANDO TABLE VENDAS_ITENS--
    *Para que não seja possivel duplicar itens
    ALTER TABLE vendas_itens
    ADD UNIQUE KEY uk_venda_produto (venda_id, produto_id);

---FIM VENDAS ITENS---

---VENDAS PAGAMENTOS---
    CREATE TABLE vendas_pagamentos (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,

    venda_id BIGINT UNSIGNED NOT NULL,

    forma_pagamento ENUM(
        'dinheiro',
        'pix',
        'debito',
        'credito',
        'transferencia'
    ) NOT NULL,

    valor DECIMAL(10,2) NOT NULL,

    taxa DECIMAL(10,2) DEFAULT 0,

    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_venda (venda_id),

    CONSTRAINT fk_pag_venda
        FOREIGN KEY (venda_id) REFERENCES vendas(id)
    );
---FIM VENDAS PAGAMENTOS---



